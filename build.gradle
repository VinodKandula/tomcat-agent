plugins {
    id 'java' // or 'groovy' Must be explicitly applied
    id 'com.github.johnrengelman.shadow' version '1.2.3'
}

group 'io.tair'
version '1.0'

apply plugin: 'java'
apply plugin: 'application'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.apache.tomcat:tomcat-catalina:7.0.50'
    compile 'org.apache.tomcat:tomcat-servlet-api:7.0.50'
    compile 'org.apache.tomcat:tomcat-jsp-api:7.0.50'
    testCompile group: 'junit', name: 'junit', version: '4.11'
    compile 'net.bytebuddy:byte-buddy:1.3.19'
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.13'
}

mainClassName = "io.tair.Main"

applicationDefaultJvmArgs = ["-javaagent:build/libs/myagent-1.0-SNAPSHOT.jar"]

run.dependsOn jar

jar {
    manifest {
        attributes("Manifest-Version": "1.0",
                   "Premain-Class": "io.tair.myagent.Agent")
    }
}

shadowJar {
    dependencies {
        include(dependency('net.bytebuddy:byte-buddy:1.3.19'))
        include(dependency('org.apache.tomcat:tomcat-servlet-api:7.0.50'))
        include(dependency('org.apache.tomcat:tomcat-jsp-api:7.0.50'))
    }
}
